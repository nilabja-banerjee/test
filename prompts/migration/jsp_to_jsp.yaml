metadata:
  name: "JSP to Standard MVC JSP Migration"
  description: "Convert Struts JSP pages to standard JSP using JSTL/EL and best practices"
  version: "1.2"
  author: "Migration System"
  last_updated: "2025-08-02"
  target_framework: "Standard Servlet MVC (JSTL + EL)"
  target_java: "Java 21 LTS"
  success_criteria:
    - "No Struts taglib declarations or scriptlets remain"
    - "JSTL core (`c`) and fmt (`fmt`) libraries exclusively used"
    - "Expression Language (`${…}`) for dynamic content"
    - "Standard HTML5 form and link elements with `<c:url>`"
    - "View logic delegated entirely to JSTL/EL"
    - "Accessible and semantic HTML5 structure"
    - "Form functionality, validation, and error display preserved"
    - "CSRF token included for form submissions where required"
    - "Internationalization via `<fmt:message>`"

templates:
  comprehensive_jsp_migration:
    name: "Full JSP Migration to JSTL & EL"
    description: "Convert any Struts-based JSP to plain JSP with JSTL and Expression Language"
    template: |
      You are a JSP/MVC expert. Migrate the following JSP page from Struts taglibs and scriptlets to modern JSP using JSTL core and formatting tags, and Expression Language (EL). No Struts dependencies or Java code in JSP; all dynamic behavior via JSTL/EL.

      CONTEXT:
      - Complexity: {complexity}
      - Page Type: {page_type}
      - Business Domain: {business_domain}

      ORIGINAL JSP:
      ```
      {source_code}
      ```

      DETECTED STRUTS TAGS & SCRIPTLETS:
      {detected_patterns}

      MIGRATION REQUIREMENTS:
      1. **Remove Struts Taglibs**  
         - Delete all `<%@ taglib uri="http://struts.apache.org/tags-*" %>` directives  
      2. **Use JSTL Core & Formatting**  
         - `<logic:iterate name="list" id="item">` → `<c:forEach var="item" items="${list}">`  
         - `<bean:write name="bean" property="prop"/>` → `<c:out value="${bean.prop}"/>`  
         - `<html:link action="/path">` → `<a href="<c:url value='/path'/>">`  
      3. **Standard Form Elements**  
         - `<html:form action="/submit">` → `<form action="${pageContext.request.contextPath}/submit" method="post">`  
         - `<html:input property="field"/>` → `<input type="text" name="field" value="${param.field}"/>`  
         - `<html:password property="pw"/>` → `<input type="password" name="pw" value="${param.pw}"/>`  
         - `<html:errors property="field"/>` →  
           `<c:if test="${not empty errors.field}"><span class="error">${errors.field}</span></c:if>`  
      4. **Expression Language for Scriptlets**  
         - Replace `<%=`…`%>` → `${}`; remove any `<% … %>` blocks  
      5. **Internationalization**  
         - `<bean:message key="key"/>` → `<fmt:message key="key"/>` and configure `<fmt:setBundle basename="messages"/>`  
      6. **CSRF Protection**  
         - Add `<input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}"/>` inside each form  
      7. **Resource URLs**  
         - Use `<c:url>` for CSS/JS: `<link href="<c:url value='/css/app.css'/>" rel="stylesheet"/>`  
      8. **HTML5 & Accessibility**  
         - Use `<!DOCTYPE html>` and `<html lang="en" xmlns:c="http://java.sun.com/jsp/jstl/core" xmlns:fmt="http://java.sun.com/jsp/jstl/fmt">`  
         - Semantic elements (`<nav>`, `<main>`, `<section>`), ARIA labels if needed

      OUTPUT REQUIREMENTS:
      - Complete JSP file with only JSTL and EL
      - Include `<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>` and `<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>`  
      - No Struts tags or scriptlets  
      - All dynamic content via `${}` or `<c:*>` only  
      - Raw JSP code only—no explanatory text  

      Generate the fully converted JSP page:
    parameters:
      - complexity
      - page_type
      - business_domain
      - detected_patterns
      - source_code

validation:
  success_indicators:
    - "No Struts taglib directives remain"
    - "All dynamic references use `${}` or JSTL tags"
    - "JSP passes compilation under standard JSP container"
    - "Semantic, accessible HTML5 layout preserved"
    - "Form and links function correctly with `<c:url>`"

  quality_checks:
    - "No `<% ... %>` scriptlets"
    - "Correct use of `<c:forEach>`, `<c:out>`, `<fmt:message>`"
    - "Proper escaping and security (XSS prevention via `<c:out>`)”  
    - "CSRF tokens present in all forms"
    - "Internationalization correctly configured"
    - "Responsive and accessible markup"
